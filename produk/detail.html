<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Produk</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="detail.css">
</head>
<body>
  <div class="parent">
    <!-- Div 1: Hanya gambar produk -->
    <div class="div1">
      <img id="productImage" class="product-image" src="" alt="Gambar Produk">
    </div>
    
    <!-- Div 2: Semua informasi produk kecuali deskripsi -->
    <div class="div2" id="productInfo">
      <h1 id="productName"></h1>
      <p><strong>Kategori:</strong> <span id="productCategory"></span></p>
      <p><strong>Harga:</strong> Rp <span id="productPrice"></span></p>
      <p><strong>Stok Total:</strong> <span id="totalStock"></span></p>
      <p><strong>Total Terjual:</strong> <span id="totalSold"></span></p>
      
      <label for="variasi">Pilih Varian:</label>
      <select id="variasi"></select>

      <div>
        <button id="kurang">-</button>
        <span id="jumlah">1</span>
        <button id="tambah">+</button>
      </div>
      <button id="beli">Beli Sekarang</button>
    </div>


    <!-- div3: Deskripsi Produk -->
    <div class="div3">
      <h2>Deskripsi Produk</h2>
      <p id="productDescription"></p>
      <div style="text-align: right; margin-top: 20px;">
        <a href="banding_produk.html" style="text-decoration: none; color: #007BFF;">Bandingkan Produk</a>
      </div>
    </div>

    
    <div class="div4">
      <a href="../index.html"><i class="fa-solid fa-arrow-left"></i></a>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const nama = params.get("nama");
      const data = JSON.parse(localStorage.getItem("produk")) || [];

      const produk = data.find(p => p.nama === nama);

      if (!produk) {
        document.getElementById("productName").textContent = "Produk tidak ditemukan";
        return;
      }

      // Isi div1 (gambar)
      const productImage = document.getElementById("productImage");
      productImage.src = produk.gambar || 'https://via.placeholder.com/300x160';
      productImage.alt = produk.nama;

      // Isi div2 (informasi produk)
      document.getElementById("productName").textContent = produk.nama;
      document.getElementById("productCategory").textContent = produk.kategori;
      document.getElementById("productPrice").textContent = produk.harga.toLocaleString('id-ID');
      
      const totalStok = produk.variasi ? produk.variasi.reduce((a, v) => a + (v.stok || 0), 0) : 0;
      const totalTerjual = produk.variasi ? produk.variasi.reduce((a, v) => a + (v.terjual || 0), 0) : 0;
      
      document.getElementById("totalStock").textContent = totalStok;
      document.getElementById("totalSold").textContent = totalTerjual;

      // Isi div3 (deskripsi)
      document.getElementById("productDescription").textContent = produk.deskripsi || "Tidak ada deskripsi produk";

      // Setup variasi dan pembelian
      const produkList = JSON.parse(localStorage.getItem("produk")) || [];
      const produkIndex = produkList.findIndex(p => p.nama === nama);
      const variasiSelect = document.getElementById("variasi");
      const jumlahSpan = document.getElementById("jumlah");
      const tambahBtn = document.getElementById("tambah");
      const kurangBtn = document.getElementById("kurang");
      const beliBtn = document.getElementById("beli");

      // Tampilkan opsi variasi
      produk.variasi?.forEach((v, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `${v.nama} (Stok: ${v.stok})`;
        variasiSelect.appendChild(opt);
      });

      let jumlah = 1;
      jumlahSpan.textContent = jumlah;

      tambahBtn.addEventListener("click", () => {
        const selectedVarian = produk.variasi[variasiSelect.value];
        if (jumlah < selectedVarian.stok) {
          jumlah++;
          jumlahSpan.textContent = jumlah;
        } else {
          alert("Tidak bisa melebihi stok yang tersedia!");
        }
      });

      kurangBtn.addEventListener("click", () => {
        if (jumlah > 1) {
          jumlah--;
          jumlahSpan.textContent = jumlah;
        }
      });

      beliBtn.addEventListener("click", () => {
        const indexVarian = parseInt(variasiSelect.value);
        const varian = produk.variasi[indexVarian];

        if (varian.stok >= jumlah) {
          varian.stok -= jumlah;
          varian.terjual = (varian.terjual || 0) + jumlah;

          // Simpan kembali
          produkList[produkIndex].variasi[indexVarian] = varian;
          localStorage.setItem("produk", JSON.stringify(produkList));

          alert(`Berhasil membeli ${jumlah} ${produk.nama} - ${varian.nama}`);
          location.reload();
        } else {
          alert("Stok tidak mencukupi!");
        }
      });
    });
  </script>
</body>
</html>