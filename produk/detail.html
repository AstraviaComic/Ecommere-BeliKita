<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Produk</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="asset/detail.css">
</head>
<body>
  <div class="parent">
    <div class="div1">
      <img id="productImage" class="product-image" src="" alt="Gambar Produk">
    </div>

    <div class="div2" id="productInfo">
      <h1 id="productName"></h1>
      <p><strong>Kategori:</strong> <span id="productCategory"></span></p>
      <p><strong>Harga:</strong> Rp <span id="productPrice"></span></p>
      <p><strong>Stok Total:</strong> <span id="totalStock"></span></p>
      <p><strong>Total Terjual:</strong> <span id="totalSold"></span></p>

      <label for="variasi">Pilih Varian:</label>
      <select id="variasi"></select>

      <div>
        <button id="kurang">-</button>
        <span id="jumlah">1</span>
        <button id="tambah">+</button>
      </div>

      <button id="tambahKeranjang">+ Keranjang</button>
    </div>

    <div class="div3">
      <h2>Deskripsi Produk</h2>
      <p id="productDescription"></p>
      <div style="text-align: right; margin-top: 20px;">
        <a href="banding_produk.html" style="font-weight: 900; text-decoration: none; color: #000000;">Bandingkan Produk</a>
      </div>
    </div>

    <div class="nav-icons">
      <a href="../index.html" class="back-icon" style="text-decoration: none;"><i class="fa-solid fa-arrow-left"></i></a>
      <a href="#" class="cart-icon" style="text-decoration: none;"><i class="fa-solid fa-cart-shopping"></i></a>
    </div>
  </div>

  <!-- Script tetap sama -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const nama = params.get("nama");
      const data = JSON.parse(localStorage.getItem("produk")) || [];

      const produk = data.find(p => p.nama === nama);

      if (!produk) {
        document.getElementById("productName").textContent = "Produk tidak ditemukan";
        return;
      }

      const productImage = document.getElementById("productImage");
      productImage.src = produk.gambar || 'https://via.placeholder.com/300x160';
      productImage.alt = produk.nama;

      document.getElementById("productName").textContent = produk.nama;
      document.getElementById("productCategory").textContent = produk.kategori;
      document.getElementById("productPrice").textContent = produk.harga.toLocaleString('id-ID');

      const totalStok = produk.variasi ? produk.variasi.reduce((a, v) => a + (v.stok || 0), 0) : 0;
      const totalTerjual = produk.variasi ? produk.variasi.reduce((a, v) => a + (v.terjual || 0), 0) : 0;

      document.getElementById("totalStock").textContent = totalStok;
      document.getElementById("totalSold").textContent = totalTerjual;
      document.getElementById("productDescription").textContent = produk.deskripsi || "Tidak ada deskripsi produk";

      const produkList = JSON.parse(localStorage.getItem("produk")) || [];
      const produkIndex = produkList.findIndex(p => p.nama === nama);
      const variasiSelect = document.getElementById("variasi");
      const jumlahSpan = document.getElementById("jumlah");
      const tambahBtn = document.getElementById("tambah");
      const kurangBtn = document.getElementById("kurang");
      const tambahKeranjangBtn = document.getElementById("tambahKeranjang");

      produk.variasi?.forEach((v, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `${v.nama} (Stok: ${v.stok})`;
        variasiSelect.appendChild(opt);
      });

      let jumlah = 1;
      jumlahSpan.textContent = jumlah;

      tambahBtn.addEventListener("click", () => {
        const selectedVarian = produk.variasi[variasiSelect.value];
        if (jumlah < selectedVarian.stok) {
          jumlah++;
          jumlahSpan.textContent = jumlah;
        } else {
          alert("Tidak bisa melebihi stok yang tersedia!");
        }
      });

      kurangBtn.addEventListener("click", () => {
        if (jumlah > 1) {
          jumlah--;
          jumlahSpan.textContent = jumlah;
        }
      });

      tambahKeranjangBtn.addEventListener("click", () => {
        const indexVarian = parseInt(variasiSelect.value);
        const varian = produk.variasi[indexVarian];

        if (jumlah > varian.stok) {
          alert("Jumlah melebihi stok!");
          return;
        }

        const cart = JSON.parse(localStorage.getItem("cart")) || [];

        const existing = cart.find(item =>
          item.nama === produk.nama &&
          item.varian === varian.nama
        );

        if (existing) {
          if (existing.jumlah + jumlah > varian.stok) {
            alert("Jumlah total melebihi stok tersedia!");
            return;
          }
          existing.jumlah += jumlah;
        } else {
          cart.push({
            nama: produk.nama,
            gambar: produk.gambar,
            harga: produk.harga,
            varian: varian.nama,
            jumlah: jumlah
          });
        }

        localStorage.setItem("cart", JSON.stringify(cart));
        alert(`${jumlah} produk ditambahkan ke keranjang`);
      });
    });
  </script>
</body>
</html>