<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-Commerce BeliKita - Kelola Alamat</title> <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header class="bg-blue-500 p-4">
        <div class="flex mx-20 items-center justify-between text-white">
            <div class="h-7 w-7 text-white">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                    <a href="address.html"> <path fill="currentColor"
                            d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
                    </a>
                </svg>
            </div>
            <a class="text-3xl" href="#">BeliKita</a>
        </div>
    </header>
    <div class="px-20 py-10">
        <div class="flex w-full h-full rounded-2xl">
            <div class="flex flex-col w-1/4 h-[800px] p-10 bg-gray-200 rounded-2xl shadow-xl/20">
                <div class="flex my-10 items-center justify-center">
                    <div class="flex w-36 h-36 rounded-full">
                        <div class="w-full h-full">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <path
                                    d="M399 384.2C376.9 345.8 335.4 320 288 320l-64 0c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col my-15 gap-y-5">
                    <div class="flex gap-x-4 items-center ml-10">
                        <img src="./assets/svg/profil.svg" alt="profil" class="w-10 h-10"></img>
                        <div
                            class="text-2xl tracking-widest text-black hover:text-blue-700 hover:cursor-pointer hover:scale-110">
                            <a href="account.html">Akun</a></div>
                    </div>
                    <div class="flex gap-x-4 items-center ml-10">
                        <img src="./assets/svg/addres.svg" alt="alamat" class="w-10 h-10"></img>
                        <div
                            class="text-2xl tracking-widest text-black hover:text-blue-700 hover:cursor-pointer hover:scale-110">
                            <a href="address.html">Alamat</a></div>
                    </div>
                    <div class="flex gap-x-4 items-center ml-10">
                        <img src="./assets/svg/history.svg" alt="pesanan" class="w-10 h-10"></img>
                        <div
                            class="text-2xl tracking-widest text-black hover:text-blue-700 hover:cursor-pointer hover:scale-110">
                            <a href="order.html">Pesanan</a></div>
                    </div>
                    <div class="flex gap-x-4 items-center ml-10">
                        <div class="flex w-10 h-10 items-center justify-center">
                            <img src="./assets/svg/logout.svg" alt="logout" class="ml-2 w-7 h-7"></img>
                        </div>
                        <div
                            class="text-2xl tracking-widest text-black hover:text-blue-700 hover:cursor-pointer hover:scale-110">
                            <a href="logout.html">Logout</a></div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col w-3/4 p-10 rounded-2xl">
                <div class="flex gap-x-4 items-center justify-center mb-8">
                    <div class="text-5xl font-bold" id="formTitle">Tambah Alamat Baru</div>
                </div>
                <div class="flex justify-center w-full">
                    <form id="addressForm" class="flex flex-col w-3/4 p-8">
                        <div class="mb-6">
                            <label for="recipient_name" class="block text-xl font-medium text-gray-700 mb-2">Nama
                                Penerima :</label>
                            <input type="text" id="recipient_name" name="recipient_name"
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-lg" required/>
                        </div>

                        <div class="mb-6">
                            <label for="telephone" class="block text-xl font-medium text-gray-700 mb-2">Telepon
                                :</label>
                            <input type="tel" id="address_telephone" name="telephone"
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-lg" required/>
                        </div>

                        <div class="mb-6">
                            <label for="full_address" class="block text-xl font-medium text-gray-700 mb-2">Alamat
                                Lengkap :</label>
                            <textarea id="full_address" name="full_address" rows="4"
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-lg" required></textarea>
                        </div>

                        <div class="mb-8">
                            <label for="postal_code" class="block text-xl font-medium text-gray-700 mb-2">Kode Pos
                                :</label>
                            <input type="text" id="postal_code" name="postal_code"
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-lg" required/>
                        </div>

                        <div class="flex justify-end">
                            <button type="submit"
                                class="bg-green-400 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg shadow-md">
                                Simpan Alamat
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addressForm = document.getElementById('addressForm');
            const formTitle = document.getElementById('formTitle');

            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode'); // 'add' or 'edit'
            const editIndex = urlParams.get('index'); // Index for editing

            let addresses = []; // Array untuk menyimpan semua alamat

            // Fungsi untuk memuat semua alamat dari Local Storage
            const loadAllAddresses = () => {
                const storedAddresses = localStorage.getItem('userAddresses');
                if (storedAddresses) {
                    addresses = JSON.parse(storedAddresses);
                }
            };

            // Panggil fungsi saat halaman dimuat
            loadAllAddresses();

            // Isi form jika dalam mode 'edit'
            if (mode === 'edit' && editIndex !== null) {
                formTitle.textContent = 'Edit Alamat';
                if (addresses[editIndex]) {
                    const addressToEdit = addresses[editIndex];
                    document.getElementById('recipient_name').value = addressToEdit.recipientName || '';
                    document.getElementById('address_telephone').value = addressToEdit.telephone || '';
                    document.getElementById('full_address').value = addressToEdit.fullAddress || '';
                    document.getElementById('postal_code').value = addressToEdit.postalCode || '';
                } else {
                    alert('Alamat tidak ditemukan.');
                    window.location.href = 'address.html'; // Kembali ke daftar alamat
                }
            } else {
                formTitle.textContent = 'Tambah Alamat Baru';
            }

            // Fungsi untuk menyimpan data ke Local Storage
            addressForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Mencegah form melakukan submit default

                const newAddressData = {
                    recipientName: document.getElementById('recipient_name').value,
                    telephone: document.getElementById('address_telephone').value,
                    fullAddress: document.getElementById('full_address').value,
                    postalCode: document.getElementById('postal_code').value
                };

                if (mode === 'edit' && editIndex !== null) {
                    // Update alamat yang ada
                    addresses[editIndex] = newAddressData;
                    alert('Data alamat berhasil diperbarui!');
                } else {
                    // Tambah alamat baru
                    addresses.push(newAddressData);
                    alert('Alamat baru berhasil ditambahkan!');
                }

                localStorage.setItem('userAddresses', JSON.stringify(addresses));
                window.location.href = 'address.html'; // Kembali ke halaman daftar alamat
            });
        });
    </script>
    </body>

</html>